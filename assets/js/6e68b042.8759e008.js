(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{100:function(e,a,t){"use strict";t.d(a,"a",(function(){return u}));var n=t(0),c=t.n(n);function o(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){o(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,n,c=function(e,a){if(null==e)return{};var t,n,c={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(c[t]=e[t]);return c}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(c[t]=e[t])}return c}var l=c.a.createContext({}),b=function(e){var a=c.a.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):s(s({},a),e)),t},d={inlineCode:"code",wrapper:function(e){var a=e.children;return c.a.createElement(c.a.Fragment,{},a)}},p=c.a.forwardRef((function(e,a){var t=e.components,n=e.mdxType,o=e.originalType,r=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),p=b(t),u=n,h=p["".concat(r,".").concat(u)]||p[u]||d[u]||o;return t?c.a.createElement(h,s(s({ref:a},l),{},{components:t})):c.a.createElement(h,s({ref:a},l))}));function u(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var o=t.length,r=new Array(o);r[0]=p;var s={};for(var i in a)hasOwnProperty.call(a,i)&&(s[i]=a[i]);s.originalType=e,s.mdxType="string"==typeof e?e:n,r[1]=s;for(var l=2;l<o;l++)r[l]=t[l];return c.a.createElement.apply(null,r)}return c.a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},80:function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return r})),t.d(a,"metadata",(function(){return s})),t.d(a,"toc",(function(){return i})),t.d(a,"default",(function(){return b}));var n=t(3),c=t(7),o=(t(0),t(100)),r={title:"SWAP Bandwidth Accounting",id:"swap"},s={unversionedId:"advanced/swap",id:"advanced/swap",isDocsHomePage:!1,title:"SWAP Bandwidth Accounting",description:"Underpinning Swarm is a set of accounting protocols that have been",source:"@site/docs/advanced/swap.md",slug:"/advanced/swap",permalink:"/docs/advanced/swap",editUrl:"https://github.com/ethersphere/docs.github.io/blob/master/docs/advanced/swap.md",version:"current",sidebar:"Balls",previous:{title:"Persistence",permalink:"/docs/advanced/persistence"},next:{title:"Starting a Test Network",permalink:"/docs/advanced/starting-a-test-network"}},i=[],l={toc:i};function b(e){var a=e.components,t=Object(c.a)(e,["components"]);return Object(o.a)("wrapper",Object(n.a)({},l,t,{components:a,mdxType:"MDXLayout"}),Object(o.a)("p",null,"Underpinning Swarm is a set of accounting protocols that have been\ndeveloped and prototyped during over 5 years of R&D. Your Beta Bee\nnode contains functionality giving it the ability to keep track of\nbandwidth exchanges with all its peers, issue and cache cheques using\nsmart contracts which live on EVM compatible blockchain. Currently we\nare in the testing phase using the Goerli testnet. We would love for\nyou to get involved, help us try out these incentives and maybe even\nearn some gBZZ!"),Object(o.a)("div",{className:"admonition admonition-info alert alert--info"},Object(o.a)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.a)("h5",{parentName:"div"},Object(o.a)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.a)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.a)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(o.a)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.a)("p",{parentName:"div"},"Learn more about how SWAP and the other accounting protocols work by reading\n",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://swarm-gateways.net/bzz:/latest.bookofswarm.eth/the-book-of-swarm.pdf"}),"The Book of Swarm"),"."))),Object(o.a)("p",null,"To investigate our accounting, let's upload a 20mb file to the network so we can see some traffic being generated as Bee begins to push chunks into the network. In order to do this, we will pay a forwarding cost in each node that passes the chunk on."),Object(o.a)("p",null,"First, we will need to run our Bee node with a RPC endpoint, debug api enabled and verbosity set to TRACE."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"bee start \\\n  --verbosity 5 \\\n  --swap-enable \\\n  --swap-endpoint https://rpc.slock.it/goerli \\\n  --debug-api-enable\n")),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"dd if=/dev/urandom of=/tmp/test.txt bs=1m count=20\ncurl -F file=@/tmp/test.txt http://localhost:1633/files\n")),Object(o.a)("p",null,"If we set ",Object(o.a)("inlineCode",{parentName:"p"},"--verbosity 5")," in our Bee configuration, we will be able to see these individual transactions being recorded on our node's internal per peer ledgers."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{}),"...\nTRAC[2020-09-28T15:18:08+01:00] crediting peer f1e2872581de18bdc68060dc8edd3aa96368eb341e915aba86b450486b105a47 with price 150, new balance is -2300\nTRAC[2020-09-28T15:18:08+01:00] crediting peer f1e2872581de18bdc68060dc8edd3aa96368eb341e915aba86b450486b105a47 with price 150, new balance is -2450\nTRAC[2020-09-28T15:18:08+01:00] pusher pushed chunk bd638a8c58f48ca6729b6d86b7623c524f7c74e4ed9bc71712637b8b50234ce0\nTRAC[2020-09-28T15:18:08+01:00] pusher pushed chunk b06309f68a89f1a6513d3231ad2d5335b3c0309972513a4f28d949e7fc47e39d\nTRAC[2020-09-28T15:18:08+01:00] crediting peer e00460ced3c509dfd72b6ce915c764b13669e65f95b3ba84dcb7d4b6d18a0b11 with price 150, new balance is -8780\nTRAC[2020-09-28T15:18:08+01:00] pusher pushed chunk a81c8ee73284f8c0d1b7cfa0b0907c5b12c3b56d1accd08835543771e93c7fc5\nTRAC[2020-09-28T15:18:08+01:00] pusher pushed chunk 056f59ca65bdfb8b7499c44a7d8d8ed29d7b4eaa39621b468bdbb69fc2de4b87\nTRAC[2020-09-28T15:18:08+01:00] crediting peer e00460ced3c509dfd72b6ce915c764b13669e65f95b3ba84dcb7d4b6d18a0b11 with price 150, new balance is -8930\nTRAC[2020-09-28T15:18:08+01:00] pusher pushed chunk a3c6958271aab4e1ad53206898f045a169a57aeaab0531cbcf497c8ff10a7800\nTRAC[2020-09-28T15:18:08+01:00] crediting peer f1e2872581de18bdc68060dc8edd3aa96368eb341e915aba86b450486b105a47 with price 120, new balance is -2570\n...\n")),Object(o.a)("p",null,"We also have a rich set of features to be able to query the current accounting state of your node. For example, you may query your node's current balance by send a POST request to the balances endpoint."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl localhost:1635/chequebook/balance | jq\n")),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n  "totalBalance": 10000000,\n  "availableBalance": 9640360\n}\n')),Object(o.a)("p",null,"It is also possible to examine per-peer balances."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl localhost:1635/balances | jq\n")),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n  "balances": [\n    //...\n    {\n      "peer": "d0bf001e05014fa036af97f3d226bee253d2b147f540b6c2210947e5b7b409af",\n      "balance": -85420\n    },\n    {\n      "peer": "f1e2872581de18bdc68060dc8edd3aa96368eb341e915aba86b450486b105a47",\n      "balance": -75990\n    }\n    //...\n  ]\n}\n')),Object(o.a)("p",null,"In Swarm, these per-peer balances simply represent trustful agreements between nodes. Tokens only actually change hands when a node settles a cheque. This can either be triggered manually or when a certain threshold is reached with a peer. In this case, a settlement takes place. You may view these using the settlements endpoint."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl localhost:1635/settlements | jq\n")),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n  "totalreceived": 0,\n  "totalsent": 359640,\n  "settlements": [\n    // ...\n    {\n      "peer": "d0bf001e05014fa036af97f3d226bee253d2b147f540b6c2210947e5b7b409af",\n      "received": 0,\n      "sent": 90070\n    },\n    {\n      "peer": "f1e2872581de18bdc68060dc8edd3aa96368eb341e915aba86b450486b105a47",\n      "received": 89890,\n      "sent": 0\n    }\n    // ...\n  ]\n}\n')),Object(o.a)("p",null,"More info can be found by using the chequebook api."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl localhost:1635/chequebook/cheque | jq\n")),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n  "totalreceived": 0,\n  "totalsent": 718030,\n  "settlements": [\n    //...\n    {\n      "peer": "dce1833609db868e7611145b48224c061ea57fd14e784a278f2469f355292ca6",\n      "received": 0,\n      "sent": 89550\n    }\n    //...\n  ]\n}\n')),Object(o.a)("p",null,"As our node's participation in the network increases, we will begin to see more and more of these balances arriving. In the case that we have ",Object(o.a)("em",{parentName:"p"},"received")," a settlement from another peer, we can ask our node to perform the relevant transactions on the blockchain, and cash our earnings out."),Object(o.a)("p",null,"To do this, we simply POST the relevant peer's address to the ",Object(o.a)("inlineCode",{parentName:"p"},"cashout")," endpoint."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl -XPOST http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b\n")),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{"transactionHash":"0xba7b500e21fc0dc0d7163c13bb5fea235d4eb769d342e9c007f51ab8512a9a82"}\n')),Object(o.a)("p",null,"You may check the status of your transaction using ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://goerli.etherscan.io/"}),"Goerli Etherscan")),Object(o.a)("p",null,"Finally, we can now see the status of the cashout transaction by sending a GET request to the same URL."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b | jq\n")),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n  "peer": "d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b",\n  "chequebook": "0xae315a9adf0920ba4f3353e2f011031ca701d247",\n  "cumulativePayout": 179160,\n  "beneficiary": "0x21b26864067deb88e2d5cdca512167815f2910d3",\n  "transactionHash": "0xba7b500e21fc0dc0d7163c13bb5fea235d4eb769d342e9c007f51ab8512a9a82",\n  "result": {\n    "recipient": "0x312fe7fde9e0768337c9b3e3462189ea6f9f9066",\n    "lastPayout": 179160,\n    "bounced": false\n  }\n}\n')),Object(o.a)("p",null,"Success, we earned our first gBZZ! \ud83d\udc1d"),Object(o.a)("p",null,"Now we have earnt tokens, to withdraw our gBZZ from the chequebook contract back into our node's own wallet, we simply POST a request to the chequebook withdraw endpoint."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl -XPOST http://localhost:1635/chequebook/withdraw\\?amount\\=1000 | jq\n")),Object(o.a)("p",null,"And conversely, if we have used more services than we have provided, we may deposit extra gBZZ into the chequebook contract by sending a POST request to the deposit endpoint."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl -XPOST http://localhost:1635/chequebook/deposit\\?amount\\=1000 | jq\n")),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{"transactionHash":"0x60fd4be6c1db4552ecb5cd3c99f6a4906089277f592593cccd1fee0dbf501085"}\n')),Object(o.a)("p",null,"You may use then Etherscan to track your transaction and make sure it completes successfully."),Object(o.a)("p",null,Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://goerli.etherscan.io/tx/0xedc80ebc89e6d719e617a50c6900c3dd5dc2f283e1b8c447b9065d7c8280484a"}),"https://goerli.etherscan.io/tx/0xedc80ebc89e6d719e617a50c6900c3dd5dc2f283e1b8c447b9065d7c8280484a`")),Object(o.a)("h1",{id:"managing-uncashed-cheques"},"Managing uncashed cheques"),Object(o.a)("p",null,"For the Bee process, the final step of earning BZZ is cashing a swap-cheque. It is worth noting that a cheque is not yet generally accepted currency. A swap-cheque is, just like a real cheque, a promise to hand over money upon request. In real life, you would present the cheque to a bank. In blockchain life, we are presenting the swap-cheque to a smart-contract. Holding on to a swap-cheque is risky; it is possible that the owner of the chequebook has issued too many cheques, worth more than there is money in the chequebook contract. For this reason you want to cash out your cheques with a certain frequency. With the set of API endpoints, as offered by Bee, it is possible to develop a script that fully manages the uncashed cheques for you. As an example, we offer you a ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://gist.github.com/ralph-pichler/3b5ccd7a5c5cd0500e6428752b37e975#file-cashout-sh"}),"very basic script"),", where you can manually cash out all cheques with a worth above a certain value. To use the script:"),Object(o.a)("ol",null,Object(o.a)("li",{parentName:"ol"},"Download and save the script:")),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"wget -O cashout.sh https://gist.githubusercontent.com/ralph-pichler/3b5ccd7a5c5cd0500e6428752b37e975/raw/7ba05095e0836735f4a648aefe52c584e18e065f/cashout.sh\n")),Object(o.a)("ol",{start:2},Object(o.a)("li",{parentName:"ol"},"Make the file executable")),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"chmod +x cashout.sh\n")),Object(o.a)("ol",{start:3},Object(o.a)("li",{parentName:"ol"},"List all uncashed cheques and cash out your cheques above a certain value")),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},"List:")),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"./cashout.sh\n")),Object(o.a)("div",{className:"admonition admonition-info alert alert--info"},Object(o.a)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.a)("h5",{parentName:"div"},Object(o.a)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.a)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.a)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(o.a)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.a)("p",{parentName:"div"},"If running ./cashout.sh returns nothing, you currently have no uncashed cheques."))),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},"Cashout all cheques worth more than 5 BZZ")),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"./cashout.sh cashout-all 5\n")),Object(o.a)("div",{className:"admonition admonition-info alert alert--info"},Object(o.a)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.a)("h5",{parentName:"div"},Object(o.a)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.a)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.a)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(o.a)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.a)("p",{parentName:"div"},"Are you a Windows-user who is willing to help us? We are currently missing a simple cashout script for Windows. Please see the ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/ethersphere/bee/issues/1092"}),"issue")))),Object(o.a)("div",{className:"admonition admonition-info alert alert--info"},Object(o.a)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.a)("h5",{parentName:"div"},Object(o.a)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.a)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.a)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(o.a)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.a)("p",{parentName:"div"},"Please find the officially deployed smart-contract by the Swarm team on the ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/ethersphere/swap-swear-and-swindle"}),"swap-swear-and-swindle repository")))))}b.isMDXComponent=!0}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{68:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return b})),a.d(t,"rightToc",(function(){return s})),a.d(t,"default",(function(){return l}));var n=a(2),c=a(6),r=(a(0),a(87)),o={title:"SWAP Bandwidth Accounting",id:"swap"},b={unversionedId:"advanced/swap",id:"advanced/swap",isDocsHomePage:!1,title:"SWAP Bandwidth Accounting",description:"Underpinning Swarm is a set of accounting protocols that have been developed and prototyped during over 5 years of R&D. Your Beta Bee node contains functionality giving it the ability to keep track of bandwidth exchanges with all it's peers, issue and cache cheques using smart contracts which live on EVM compatible blockchain. Currently we are in the testing phase using the Goerli testnet. We would love for you to get involved, help us try out these incentives and maybe even earn some gBZZ!",source:"@site/docs/advanced/swap.md",permalink:"/docs/advanced/swap",editUrl:"https://github.com/ethersphere/docs.github.io/blob/master/docs/advanced/swap.md",sidebar:"Balls",previous:{title:"Persistence",permalink:"/docs/advanced/persistence"},next:{title:"Starting a Test Network",permalink:"/docs/advanced/starting-a-test-network"}},s=[],i={rightToc:s};function l(e){var t=e.components,a=Object(c.a)(e,["components"]);return Object(r.b)("wrapper",Object(n.a)({},i,a,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Underpinning Swarm is a set of accounting protocols that have been developed and prototyped during over 5 years of R&D. Your Beta Bee node contains functionality giving it the ability to keep track of bandwidth exchanges with all it's peers, issue and cache cheques using smart contracts which live on EVM compatible blockchain. Currently we are in the testing phase using the Goerli testnet. We would love for you to get involved, help us try out these incentives and maybe even earn some gBZZ!"),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Learn more about how SWAP and the other accounting protocols work by reading\n",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://swarm-gateways.net/bzz:/latest.bookofswarm.eth/the-book-of-swarm.pdf"}),"The Book of Swarm"),"."))),Object(r.b)("p",null,"To investigate our accounting, let's upload a 20mb file to the network so we can see some traffic being generated as Bee begins to push chunks into the network. In order to do this, we will pay a forwarding cost in each node that passes the chunk on."),Object(r.b)("p",null,"First, we will need to run our Bee node with a RPC endpoint, debug api enabled and verbosity set to TRACE."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"bee start \\\n  --verbosity 5 \\\n  --swap-enable \\\n  --swap-endpoint https://rpc.slock.it/goerli \\\n  --debug-api-enable\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"dd if=/dev/urandom of=/tmp/test.txt bs=1m count=20\ncurl -F file=@/tmp/test.txt http://localhost:1633/files\n")),Object(r.b)("p",null,"If we set ",Object(r.b)("inlineCode",{parentName:"p"},"--verbosity 5")," in our Bee configuration, we will be able to see these individual transactions being recorded on our node's internal per peer ledgers."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{}),"...\nTRAC[2020-09-28T15:18:08+01:00] crediting peer f1e2872581de18bdc68060dc8edd3aa96368eb341e915aba86b450486b105a47 with price 150, new balance is -2300\nTRAC[2020-09-28T15:18:08+01:00] crediting peer f1e2872581de18bdc68060dc8edd3aa96368eb341e915aba86b450486b105a47 with price 150, new balance is -2450\nTRAC[2020-09-28T15:18:08+01:00] pusher pushed chunk bd638a8c58f48ca6729b6d86b7623c524f7c74e4ed9bc71712637b8b50234ce0\nTRAC[2020-09-28T15:18:08+01:00] pusher pushed chunk b06309f68a89f1a6513d3231ad2d5335b3c0309972513a4f28d949e7fc47e39d\nTRAC[2020-09-28T15:18:08+01:00] crediting peer e00460ced3c509dfd72b6ce915c764b13669e65f95b3ba84dcb7d4b6d18a0b11 with price 150, new balance is -8780\nTRAC[2020-09-28T15:18:08+01:00] pusher pushed chunk a81c8ee73284f8c0d1b7cfa0b0907c5b12c3b56d1accd08835543771e93c7fc5\nTRAC[2020-09-28T15:18:08+01:00] pusher pushed chunk 056f59ca65bdfb8b7499c44a7d8d8ed29d7b4eaa39621b468bdbb69fc2de4b87\nTRAC[2020-09-28T15:18:08+01:00] crediting peer e00460ced3c509dfd72b6ce915c764b13669e65f95b3ba84dcb7d4b6d18a0b11 with price 150, new balance is -8930\nTRAC[2020-09-28T15:18:08+01:00] pusher pushed chunk a3c6958271aab4e1ad53206898f045a169a57aeaab0531cbcf497c8ff10a7800\nTRAC[2020-09-28T15:18:08+01:00] crediting peer f1e2872581de18bdc68060dc8edd3aa96368eb341e915aba86b450486b105a47 with price 120, new balance is -2570\n...\n")),Object(r.b)("p",null,"We also have a rich set of features to be able to query the current accounting state of your node. For example, you may query your node's current balance by send a POST request to the balances endpoint."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl localhost:1635/chequebook/balance | jq\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n  "totalBalance": 10000000,\n  "availableBalance": 9640360\n}\n')),Object(r.b)("p",null,"It is also possible to examine per-peer balances."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl localhost:1635/balances | jq\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n  "balances": [\n    //...\n    {\n      "peer": "d0bf001e05014fa036af97f3d226bee253d2b147f540b6c2210947e5b7b409af",\n      "balance": -85420\n    },\n    {\n      "peer": "f1e2872581de18bdc68060dc8edd3aa96368eb341e915aba86b450486b105a47",\n      "balance": -75990\n    }\n    //...\n  ]\n}\n')),Object(r.b)("p",null,"In Swarm, these per-peer balances simply represent trustful agreements between nodes. Tokens only actually change hands when a node settles a cheque. This can either be triggered manually or when a certain threshold is reached with a peer. In this case, a settlement takes place. You may view these using the settlements endpoint."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl localhost:1635/settlements | jq\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n  "totalreceived": 0,\n  "totalsent": 359640,\n  "settlements": [\n    // ...\n    {\n      "peer": "d0bf001e05014fa036af97f3d226bee253d2b147f540b6c2210947e5b7b409af",\n      "received": 0,\n      "sent": 90070\n    },\n    {\n      "peer": "f1e2872581de18bdc68060dc8edd3aa96368eb341e915aba86b450486b105a47",\n      "received": 89890,\n      "sent": 0\n    }\n    // ...\n  ]\n}\n')),Object(r.b)("p",null,"More info can be found by using the chequebook api."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl localhost:1635/chequebook/cheque | jq\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n  "totalreceived": 0,\n  "totalsent": 718030,\n  "settlements": [\n    //...\n    {\n      "peer": "dce1833609db868e7611145b48224c061ea57fd14e784a278f2469f355292ca6",\n      "received": 0,\n      "sent": 89550\n    }\n    //...\n  ]\n}\n')),Object(r.b)("p",null,"As our node's participation in the network increases, we will begin to see more and more of these balances arriving. In the case that we have ",Object(r.b)("em",{parentName:"p"},"received")," a settlement from another peer, we can ask our node to perform the relevant transactions on the blockchain, and cash our earnings out."),Object(r.b)("p",null,"To do this, we simply POST the relevant peer's address to the ",Object(r.b)("inlineCode",{parentName:"p"},"cashout")," endpoint."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl -XPOST http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{"transactionHash":"0xba7b500e21fc0dc0d7163c13bb5fea235d4eb769d342e9c007f51ab8512a9a82"}\n')),Object(r.b)("p",null,"You may check the status of your transaction using ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://goerli.etherscan.io/"}),"Goerli Etherscan")),Object(r.b)("p",null,"Finally, we can now see the status of the cashout transaction by sending a GET request to the same URL."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b | jq\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n  "peer": "d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b",\n  "chequebook": "0xae315a9adf0920ba4f3353e2f011031ca701d247",\n  "cumulativePayout": 179160,\n  "beneficiary": "0x21b26864067deb88e2d5cdca512167815f2910d3",\n  "transactionHash": "0xba7b500e21fc0dc0d7163c13bb5fea235d4eb769d342e9c007f51ab8512a9a82",\n  "result": {\n    "recipient": "0x312fe7fde9e0768337c9b3e3462189ea6f9f9066",\n    "lastPayout": 179160,\n    "bounced": false\n  }\n}\n')),Object(r.b)("p",null,"Success, we earned our first gBZZ! \ud83d\udc1d"),Object(r.b)("p",null,"Now we have earnt tokens, to withdraw our gBZZ from the chequebook contract back into our node's own wallet, we simply POST a request to the chequebook withdraw endpoint."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl -XPOST http://localhost:1635/chequebook/withdraw\\?amount\\=1000 | jq\n")),Object(r.b)("p",null,"And conversely, if we have used more services than we have provided, we may deposit extra gBZZ into the chequebook contract by sending a POST request to the deposit endpoint."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-sh"}),"curl -XPOST http://localhost:1635/chequebook/deposit\\?amount\\=1000 | jq\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{"transactionHash":"0x60fd4be6c1db4552ecb5cd3c99f6a4906089277f592593cccd1fee0dbf501085"}\n')),Object(r.b)("p",null,"You may use then Etherscan to track your transaction and make sure it completes successfully."),Object(r.b)("p",null,Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://goerli.etherscan.io/tx/0xedc80ebc89e6d719e617a50c6900c3dd5dc2f283e1b8c447b9065d7c8280484a"}),"https://goerli.etherscan.io/tx/0xedc80ebc89e6d719e617a50c6900c3dd5dc2f283e1b8c447b9065d7c8280484a`")))}l.isMDXComponent=!0},87:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return h}));var n=a(0),c=a.n(n);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,c=function(e,t){if(null==e)return{};var a,n,c={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(c[a]=e[a]);return c}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(c[a]=e[a])}return c}var i=c.a.createContext({}),l=function(e){var t=c.a.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):b(b({},t),e)),a},d=function(e){var t=l(e.components);return c.a.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return c.a.createElement(c.a.Fragment,{},t)}},u=c.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,o=e.parentName,i=s(e,["components","mdxType","originalType","parentName"]),d=l(a),u=n,h=d["".concat(o,".").concat(u)]||d[u]||p[u]||r;return a?c.a.createElement(h,b(b({ref:t},i),{},{components:a})):c.a.createElement(h,b({ref:t},i))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,o=new Array(r);o[0]=u;var b={};for(var s in t)hasOwnProperty.call(t,s)&&(b[s]=t[s]);b.originalType=e,b.mdxType="string"==typeof e?e:n,o[1]=b;for(var i=2;i<r;i++)o[i]=a[i];return c.a.createElement.apply(null,o)}return c.a.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);